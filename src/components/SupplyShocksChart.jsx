import React, { useEffect, useState } from "react";
import Plotly from "plotly.js-dist";

const SupplyShockChart = ({ className, selected ,isOpen}) => {
  const [dimensions, setDimensions] = useState({
    width: window.innerWidth,
    height: window.innerHeight * 0.6, // Use 60% of the screen height
  });

  const processedEmissionsData = [
    {
      Month: 0,
      "Ecosystem Rewards": 0,
      "Ecosystem Fund": 0,
      "Pre Seed": 0,
      Seed: 0,
      "Private Sale 1": 0,
      "Private Sale 2": 0,
      "Private Sale 3": 0,
      Strategic: 0,
      KOLs: 4485000,
      "Public Sale (ICO)": 104000000,
      Airdrop: 20800000,
    },
    {
      Month: 1,
      "Ecosystem Rewards": 8320000,
      "Ecosystem Fund": 0,
      "Pre Seed": 0,
      Seed: 0,
      "Private Sale 1": 0,
      "Private Sale 2": 0,
      "Private Sale 3": 0,
      Strategic: 0,
      KOLs: 0,
      "Public Sale (ICO)": 0,
      Airdrop: 0,
    },
    {
      Month: 2,
      "Ecosystem Rewards": 8320000,
      "Ecosystem Fund": 0,
      "Pre Seed": 0,
      Seed: 0,
      "Private Sale 1": 0,
      "Private Sale 2": 0,
      "Private Sale 3": 0,
      Strategic: 19968000,
      KOLs: 5083000,
      "Public Sale (ICO)": 0,
      Airdrop: 0,
    },
    {
      Month: 3,
      "Ecosystem Rewards": 8320000,
      "Ecosystem Fund": 0,
      "Pre Seed": 0,
      Seed: 0,
      "Private Sale 1": 0,
      "Private Sale 2": 0,
      "Private Sale 3": 0,
      Strategic: 19968000,
      KOLs: 5083000,
      "Public Sale (ICO)": 0,
      Airdrop: 0,
    },
    {
      Month: 4,
      "Ecosystem Rewards": 8320000,
      "Ecosystem Fund": 0,
      "Pre Seed": 0,
      Seed: 0,
      "Private Sale 1": 0,
      "Private Sale 2": 4680000,
      "Private Sale 3": 7280000,
      Strategic: 19968000,
      KOLs: 5083000,
      "Public Sale (ICO)": 0,
      Airdrop: 0,
    },
    {
      Month: 5,
      "Ecosystem Rewards": 8320000,
      "Ecosystem Fund": 0,
      "Pre Seed": 0,
      Seed: 0,
      "Private Sale 1": 3351111.1088000005,
      "Private Sale 2": 4680000,
      "Private Sale 3": 7280000,
      Strategic: 19968000,
      KOLs: 5083000,
      "Public Sale (ICO)": 0,
      Airdrop: 0,
    },
    {
      Month: 6,
      "Ecosystem Rewards": 8320000,
      "Ecosystem Fund": 0,
      "Pre Seed": 0,
      Seed: 485333.3316,
      "Private Sale 1": 3351111.1088000005,
      "Private Sale 2": 4680000,
      "Private Sale 3": 7280000,
      Strategic: 19968000,
      KOLs: 5083000,
      "Public Sale (ICO)": 0,
      Airdrop: 0,
    },
    {
      Month: 7,
      "Ecosystem Rewards": 8320000,
      "Ecosystem Fund": 8153600,
      "Pre Seed": 1594666.6684,
      Seed: 485333.3316,
      "Private Sale 1": 3351111.1088000005,
      "Private Sale 2": 4680000,
      "Private Sale 3": 7280000,
      Strategic: 0,
      KOLs: 0,
      "Public Sale (ICO)": 0,
      Airdrop: 0,
    },
    {
      Month: 8,
      "Ecosystem Rewards": 8320000,
      "Ecosystem Fund": 8153600,
      "Pre Seed": 1594666.6684,
      Seed: 485333.3316,
      "Private Sale 1": 3351111.1088000005,
      "Private Sale 2": 4680000,
      "Private Sale 3": 7280000,
      Strategic: 0,
      KOLs: 0,
      "Public Sale (ICO)": 0,
      Airdrop: 0,
    },
    {
      Month: 9,
      "Ecosystem Rewards": 8320000,
      "Ecosystem Fund": 8153600,
      "Pre Seed": 1594666.6684,
      Seed: 485333.3316,
      "Private Sale 1": 3351111.1088000005,
      "Private Sale 2": 4680000,
      "Private Sale 3": 7280000,
      Strategic: 0,
      KOLs: 0,
      "Public Sale (ICO)": 0,
      Airdrop: 0,
    },
    {
      Month: 10,
      "Ecosystem Rewards": 8320000,
      "Ecosystem Fund": 8153600,
      "Pre Seed": 1594666.6684,
      Seed: 485333.3316,
      "Private Sale 1": 3351111.1088000005,
      "Private Sale 2": 4680000,
      "Private Sale 3": 7280000,
      Strategic: 0,
      KOLs: 0,
      "Public Sale (ICO)": 0,
      Airdrop: 0,
    },
    {
      Month: 11,
      "Ecosystem Rewards": 8320000,
      "Ecosystem Fund": 8153600,
      "Pre Seed": 1594666.6684,
      Seed: 485333.3316,
      "Private Sale 1": 3351111.1088000005,
      "Private Sale 2": 4680000,
      "Private Sale 3": 7280000,
      Strategic: 0,
      KOLs: 0,
      "Public Sale (ICO)": 0,
      Airdrop: 0,
    },
    {
      Month: 12,
      "Ecosystem Rewards": 8320000,
      "Ecosystem Fund": 8153600,
      "Pre Seed": 1594666.6684,
      Seed: 485333.3316,
      "Private Sale 1": 3351111.1088000005,
      "Private Sale 2": 4680000,
      "Private Sale 3": 0,
      Strategic: 0,
      KOLs: 0,
      "Public Sale (ICO)": 0,
      Airdrop: 0,
    },
    {
      Month: 13,
      "Ecosystem Rewards": 8320000,
      "Ecosystem Fund": 8153600,
      "Pre Seed": 1594666.6684,
      Seed: 485333.3316,
      "Private Sale 1": 3351111.1088000005,
      "Private Sale 2": 4680000,
      "Private Sale 3": 0,
      Strategic: 0,
      KOLs: 0,
      "Public Sale (ICO)": 0,
      Airdrop: 0,
    },
    {
      Month: 14,
      "Ecosystem Rewards": 8320000,
      "Ecosystem Fund": 8153600,
      "Pre Seed": 1594666.6684,
      Seed: 485333.3316,
      "Private Sale 1": 3351111.1088000005,
      "Private Sale 2": 4680000,
      "Private Sale 3": 0,
      Strategic: 0,
      KOLs: 0,
      "Public Sale (ICO)": 0,
      Airdrop: 0,
    },
    {
      Month: 15,
      "Ecosystem Rewards": 8320000,
      "Ecosystem Fund": 8153600,
      "Pre Seed": 1594666.6684,
      Seed: 485333.3316,
      "Private Sale 1": 3351111.1088000005,
      "Private Sale 2": 4680000,
      "Private Sale 3": 0,
      Strategic: 0,
      KOLs: 0,
      "Public Sale (ICO)": 0,
      Airdrop: 0,
    },
    {
      Month: 16,
      "Ecosystem Rewards": 8320000,
      "Ecosystem Fund": 8153600,
      "Pre Seed": 1594666.6684,
      Seed: 485333.3316,
      "Private Sale 1": 3351111.1088000005,
      "Private Sale 2": 0,
      "Private Sale 3": 0,
      Strategic: 0,
      KOLs: 0,
      "Public Sale (ICO)": 0,
      Airdrop: 0,
    },
    {
      Month: 17,
      "Ecosystem Rewards": 8320000,
      "Ecosystem Fund": 8153600,
      "Pre Seed": 1594666.6684,
      Seed: 485333.3316,
      "Private Sale 1": 3351111.1088000005,
      "Private Sale 2": 0,
      "Private Sale 3": 0,
      Strategic: 0,
      KOLs: 0,
      "Public Sale (ICO)": 0,
      Airdrop: 0,
    },
    {
      Month: 18,
      "Ecosystem Rewards": 8320000,
      "Ecosystem Fund": 8153600,
      "Pre Seed": 1594666.6684,
      Seed: 485333.3316,
      "Private Sale 1": 3351111.1088000005,
      "Private Sale 2": 0,
      "Private Sale 3": 0,
      Strategic: 0,
      KOLs: 0,
      "Public Sale (ICO)": 0,
      Airdrop: 0,
    },
    {
      Month: 19,
      "Ecosystem Rewards": 8320000,
      "Ecosystem Fund": 8153600,
      "Pre Seed": 1594666.6684,
      Seed: 485333.3316,
      "Private Sale 1": 3351111.1088000005,
      "Private Sale 2": 0,
      "Private Sale 3": 0,
      Strategic: 0,
      KOLs: 0,
      "Public Sale (ICO)": 0,
      Airdrop: 0,
    },
    {
      Month: 20,
      "Ecosystem Rewards": 8320000,
      "Ecosystem Fund": 8153600,
      "Pre Seed": 1594666.6684,
      Seed: 485333.3316,
      "Private Sale 1": 3351111.1088000005,
      "Private Sale 2": 0,
      "Private Sale 3": 0,
      Strategic: 0,
      KOLs: 0,
      "Public Sale (ICO)": 0,
      Airdrop: 0,
    },
    {
      Month: 21,
      "Ecosystem Rewards": 8320000,
      "Ecosystem Fund": 8153600,
      "Pre Seed": 1594666.6684,
      Seed: 485333.3316,
      "Private Sale 1": 3351111.1088000005,
      "Private Sale 2": 0,
      "Private Sale 3": 0,
      Strategic: 0,
      KOLs: 0,
      "Public Sale (ICO)": 0,
      Airdrop: 0,
    },
    {
      Month: 22,
      "Ecosystem Rewards": 8320000,
      "Ecosystem Fund": 8153600,
      "Pre Seed": 1594666.6684,
      Seed: 485333.3316,
      "Private Sale 1": 3351111.1088000005,
      "Private Sale 2": 0,
      "Private Sale 3": 0,
      Strategic: 0,
      KOLs: 0,
      "Public Sale (ICO)": 0,
      Airdrop: 0,
    },
    {
      Month: 23,
      "Ecosystem Rewards": 8320000,
      "Ecosystem Fund": 8153600,
      "Pre Seed": 1594666.6684,
      Seed: 485333.3316,
      "Private Sale 1": 0,
      "Private Sale 2": 0,
      "Private Sale 3": 0,
      Strategic: 0,
      KOLs: 0,
      "Public Sale (ICO)": 0,
      Airdrop: 0,
    },
    {
      Month: 24,
      "Ecosystem Rewards": 8320000,
      "Ecosystem Fund": 8153600,
      "Pre Seed": 1594666.6684,
      Seed: 485333.3316,
      "Private Sale 1": 0,
      "Private Sale 2": 0,
      "Private Sale 3": 0,
      Strategic: 0,
      KOLs: 0,
      "Public Sale (ICO)": 0,
      Airdrop: 0,
    },
    {
      Month: 25,
      "Ecosystem Rewards": 8320000,
      "Ecosystem Fund": 8153600,
      "Pre Seed": 1594666.6684,
      Seed: 485333.3316,
      "Private Sale 1": 0,
      "Private Sale 2": 0,
      "Private Sale 3": 0,
      Strategic: 0,
      KOLs: 0,
      "Public Sale (ICO)": 0,
      Airdrop: 0,
    },
    {
      Month: 26,
      "Ecosystem Rewards": 8320000,
      "Ecosystem Fund": 8153600,
      "Pre Seed": 1594666.6684,
      Seed: 485333.3316,
      "Private Sale 1": 0,
      "Private Sale 2": 0,
      "Private Sale 3": 0,
      Strategic: 0,
      KOLs: 0,
      "Public Sale (ICO)": 0,
      Airdrop: 0,
    },
    {
      Month: 27,
      "Ecosystem Rewards": 8320000,
      "Ecosystem Fund": 8153600,
      "Pre Seed": 1594666.6684,
      Seed: 485333.3316,
      "Private Sale 1": 0,
      "Private Sale 2": 0,
      "Private Sale 3": 0,
      Strategic: 0,
      KOLs: 0,
      "Public Sale (ICO)": 0,
      Airdrop: 0,
    },
    {
      Month: 28,
      "Ecosystem Rewards": 8320000,
      "Ecosystem Fund": 8153600,
      "Pre Seed": 1594666.6684,
      Seed: 485333.3316,
      "Private Sale 1": 0,
      "Private Sale 2": 0,
      "Private Sale 3": 0,
      Strategic: 0,
      KOLs: 0,
      "Public Sale (ICO)": 0,
      Airdrop: 0,
    },
    {
      Month: 29,
      "Ecosystem Rewards": 8320000,
      "Ecosystem Fund": 8153600,
      "Pre Seed": 1594666.6684,
      Seed: 485333.3316,
      "Private Sale 1": 0,
      "Private Sale 2": 0,
      "Private Sale 3": 0,
      Strategic: 0,
      KOLs: 0,
      "Public Sale (ICO)": 0,
      Airdrop: 0,
    },
    {
      Month: 30,
      "Ecosystem Rewards": 8320000,
      "Ecosystem Fund": 8153600,
      "Pre Seed": 1594666.6684,
      Seed: 485333.3316,
      "Private Sale 1": 0,
      "Private Sale 2": 0,
      "Private Sale 3": 0,
      Strategic: 0,
      KOLs: 0,
      "Public Sale (ICO)": 0,
      Airdrop: 0,
    },
    {
      Month: 31,
      "Ecosystem Rewards": 8320000,
      "Ecosystem Fund": 8153600,
      "Pre Seed": 1594666.6684,
      Seed: 485333.3316,
      "Private Sale 1": 0,
      "Private Sale 2": 0,
      "Private Sale 3": 0,
      Strategic: 0,
      KOLs: 0,
      "Public Sale (ICO)": 0,
      Airdrop: 0,
    },
    {
      Month: 32,
      "Ecosystem Rewards": 8320000,
      "Ecosystem Fund": 8153600,
      "Pre Seed": 1594666.6684,
      Seed: 485333.3316,
      "Private Sale 1": 0,
      "Private Sale 2": 0,
      "Private Sale 3": 0,
      Strategic: 0,
      KOLs: 0,
      "Public Sale (ICO)": 0,
      Airdrop: 0,
    },
    {
      Month: 33,
      "Ecosystem Rewards": 8320000,
      "Ecosystem Fund": 8153600,
      "Pre Seed": 1594666.6684,
      Seed: 485333.3316,
      "Private Sale 1": 0,
      "Private Sale 2": 0,
      "Private Sale 3": 0,
      Strategic: 0,
      KOLs: 0,
      "Public Sale (ICO)": 0,
      Airdrop: 0,
    },
    {
      Month: 34,
      "Ecosystem Rewards": 8320000,
      "Ecosystem Fund": 8153600,
      "Pre Seed": 1594666.6684,
      Seed: 485333.3316,
      "Private Sale 1": 0,
      "Private Sale 2": 0,
      "Private Sale 3": 0,
      Strategic: 0,
      KOLs: 0,
      "Public Sale (ICO)": 0,
      Airdrop: 0,
    },
    {
      Month: 35,
      "Ecosystem Rewards": 8320000,
      "Ecosystem Fund": 8153600,
      "Pre Seed": 1594666.6684,
      Seed: 485333.3316,
      "Private Sale 1": 0,
      "Private Sale 2": 0,
      "Private Sale 3": 0,
      Strategic: 0,
      KOLs: 0,
      "Public Sale (ICO)": 0,
      Airdrop: 0,
    },
    {
      Month: 36,
      "Ecosystem Rewards": 8320000,
      "Ecosystem Fund": 8153600,
      "Pre Seed": 1594666.6684,
      Seed: 0,
      "Private Sale 1": 0,
      "Private Sale 2": 0,
      "Private Sale 3": 0,
      Strategic: 0,
      KOLs: 0,
      "Public Sale (ICO)": 0,
      Airdrop: 0,
    },
    {
      Month: 37,
      "Ecosystem Rewards": 8320000,
      "Ecosystem Fund": 0,
      "Pre Seed": 0,
      Seed: 0,
      "Private Sale 1": 0,
      "Private Sale 2": 0,
      "Private Sale 3": 0,
      Strategic: 0,
      KOLs: 0,
      "Public Sale (ICO)": 0,
      Airdrop: 0,
    },
    {
      Month: 38,
      "Ecosystem Rewards": 8320000,
      "Ecosystem Fund": 0,
      "Pre Seed": 0,
      Seed: 0,
      "Private Sale 1": 0,
      "Private Sale 2": 0,
      "Private Sale 3": 0,
      Strategic: 0,
      KOLs: 0,
      "Public Sale (ICO)": 0,
      Airdrop: 0,
    },
    {
      Month: 39,
      "Ecosystem Rewards": 8320000,
      "Ecosystem Fund": 0,
      "Pre Seed": 0,
      Seed: 0,
      "Private Sale 1": 0,
      "Private Sale 2": 0,
      "Private Sale 3": 0,
      Strategic: 0,
      KOLs: 0,
      "Public Sale (ICO)": 0,
      Airdrop: 0,
    },
    {
      Month: 40,
      "Ecosystem Rewards": 8320000,
      "Ecosystem Fund": 0,
      "Pre Seed": 0,
      Seed: 0,
      "Private Sale 1": 0,
      "Private Sale 2": 0,
      "Private Sale 3": 0,
      Strategic: 0,
      KOLs: 0,
      "Public Sale (ICO)": 0,
      Airdrop: 0,
    },
    {
      Month: 41,
      "Ecosystem Rewards": 8320000,
      "Ecosystem Fund": 0,
      "Pre Seed": 0,
      Seed: 0,
      "Private Sale 1": 0,
      "Private Sale 2": 0,
      "Private Sale 3": 0,
      Strategic: 0,
      KOLs: 0,
      "Public Sale (ICO)": 0,
      Airdrop: 0,
    },
    {
      Month: 42,
      "Ecosystem Rewards": 8320000,
      "Ecosystem Fund": 0,
      "Pre Seed": 0,
      Seed: 0,
      "Private Sale 1": 0,
      "Private Sale 2": 0,
      "Private Sale 3": 0,
      Strategic: 0,
      KOLs: 0,
      "Public Sale (ICO)": 0,
      Airdrop: 0,
    },
    {
      Month: 43,
      "Ecosystem Rewards": 8320000,
      "Ecosystem Fund": 0,
      "Pre Seed": 0,
      Seed: 0,
      "Private Sale 1": 0,
      "Private Sale 2": 0,
      "Private Sale 3": 0,
      Strategic: 0,
      KOLs: 0,
      "Public Sale (ICO)": 0,
      Airdrop: 0,
    },
    {
      Month: 44,
      "Ecosystem Rewards": 8320000,
      "Ecosystem Fund": 0,
      "Pre Seed": 0,
      Seed: 0,
      "Private Sale 1": 0,
      "Private Sale 2": 0,
      "Private Sale 3": 0,
      Strategic: 0,
      KOLs: 0,
      "Public Sale (ICO)": 0,
      Airdrop: 0,
    },
    {
      Month: 45,
      "Ecosystem Rewards": 8320000,
      "Ecosystem Fund": 0,
      "Pre Seed": 0,
      Seed: 0,
      "Private Sale 1": 0,
      "Private Sale 2": 0,
      "Private Sale 3": 0,
      Strategic: 0,
      KOLs: 0,
      "Public Sale (ICO)": 0,
      Airdrop: 0,
    },
    {
      Month: 46,
      "Ecosystem Rewards": 8320000,
      "Ecosystem Fund": 0,
      "Pre Seed": 0,
      Seed: 0,
      "Private Sale 1": 0,
      "Private Sale 2": 0,
      "Private Sale 3": 0,
      Strategic: 0,
      KOLs: 0,
      "Public Sale (ICO)": 0,
      Airdrop: 0,
    },
    {
      Month: 47,
      "Ecosystem Rewards": 8320000,
      "Ecosystem Fund": 0,
      "Pre Seed": 0,
      Seed: 0,
      "Private Sale 1": 0,
      "Private Sale 2": 0,
      "Private Sale 3": 0,
      Strategic: 0,
      KOLs: 0,
      "Public Sale (ICO)": 0,
      Airdrop: 0,
    },
    {
      Month: 48,
      "Ecosystem Rewards": 8320000,
      "Ecosystem Fund": 0,
      "Pre Seed": 0,
      Seed: 0,
      "Private Sale 1": 0,
      "Private Sale 2": 0,
      "Private Sale 3": 0,
      Strategic: 0,
      KOLs: 0,
      "Public Sale (ICO)": 0,
      Airdrop: 0,
    },
  ];

  const calculateSupplyShock = (data) => {
    let cumulativeTokens = 0;

    return data.map((row, index) => {
      const totalReleased = Object.keys(row).reduce((sum, key) => {
        if (key !== "Month" && typeof row[key] === "number") {
          return sum + row[key];
        }
        return sum;
      }, 0);

      const supplyShock =
        index === 0 ? 0 : (totalReleased / cumulativeTokens) * 100; // Convert to percentage

      cumulativeTokens += totalReleased;

      return {
        Month: row.Month,
        SupplyShock: supplyShock,
        TotalReleased: totalReleased,
        CumulativeTokens: cumulativeTokens,
      };
    });
  };

  const supplyShockData = calculateSupplyShock(processedEmissionsData);
  useEffect(() => {
    const months = supplyShockData.map((d) => d.Month);
    const supplyShocks = supplyShockData.map((d) => d.SupplyShock);
  
    const data = [
      {
        x: months,
        y: supplyShocks,
        type: "bar",
        marker: {
          color: supplyShocks,
          colorscale: [
            [0, "rgb(93, 112, 180)"], // Blue for low values
            [0.5, "rgb(150, 80, 200)"], // Purple for mid values
            [1, "rgb(220, 38, 38)"], // Red for high values
          ],
          colorbar: {
            title: {
              text: "Supply Shock %",
              side: "top", // Position the title above the color bar
            },
            tickvals: [0, 5, 10, 15, 20],
            ticktext: ["0%", "5%", "10%", "15%", "20%"],
            thickness: 15, // Thickness of the color bar
            len: 0.4, // Length of the color bar relative to the chart width
            x: 0.85, // Position to the right of the chart
            y: 1.03, // Align with the top of the chart
            yanchor: "top",
            orientation: "h", // Horizontal orientation
            outlinewidth: 0, // Removes border around the color bar
            tickfont: {
              color: "white",
            },
            titlefont: {
              color: "white",
            },
            bordercolor: "transparent",
            borderwidth: 0,
          },
        },
        hovertemplate:
          "<b>Month %{x}</b><br>Supply Shock: %{y:.2f}<extra></extra>",
      },
    ];
  
    const layout = {
      title: {
        text: "Monthly Supply Shock Scale",
        font: { color: "white" },
      },
      paper_bgcolor: "#1e1e2f", // Background color
      plot_bgcolor: "#1e1e2f", // Plot area background color
      xaxis: {
        title: {
          text: "Months",
          font: { color: "white" },
        },
        tickfont: { color: "white" },
      },
      yaxis: {
        title: {
          text: "Supply Shock (%)",
          font: { color: "white" },
        },
        tickfont: { color: "white" },
      },

      height: dimensions.height,
      // width: dimensions.width,
    };
  

  
    Plotly.newPlot("supplyShockChart", data, layout, {
      responsive: true,
      displayModeBar: false,
    });
  }, [supplyShockData, dimensions, open]);
  

  return (
    <div className={` bg-black p-4 ${className}`}>
      <div className="text-center mb-4">
        <h1 className="text-xl font-semibold text-gray-300">
          Supply Shock Chart
        </h1>
      </div>
      <div
        id="supplyShockChart"
        className="bg-gray-800 rounded shadow-lg"
        style={{
          width: "100%",
          height: dimensions.height, // Dynamic height
        }}
      ></div>
    </div>
  );
};

export default SupplyShockChart;
